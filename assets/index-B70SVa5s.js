import{createClient as h}from"https://esm.sh/@supabase/supabase-js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))a(s);new MutationObserver(s=>{for(const t of s)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&a(n)}).observe(document,{childList:!0,subtree:!0});function e(s){const t={};return s.integrity&&(t.integrity=s.integrity),s.referrerPolicy&&(t.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?t.credentials="include":s.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function a(s){if(s.ep)return;s.ep=!0;const t=e(s);fetch(s.href,t)}})();const I="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1zZnV0Z2pnZmxna2NreHJla3NwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MzMwMTk1NDEsImV4cCI6MjA0ODU5NTU0MX0.pIQlsN43fHNmB1MCjONz6jomwz3x3vdgfGyfSlmWw_U",E="https://msfutgjgflgkckxreksp.supabase.co",x=I,l=h(E,x),B=document.getElementById("chart").getContext("2d");let u;function d(r){const e=`; ${document.cookie}`.split(`; ${r}=`);if(e.length===2)return e.pop().split(";").shift()}function w(r,o,e){const a=new Date;a.setTime(a.getTime()+e*24*60*60*1e3);const s=`expires=${a.toUTCString()}`;document.cookie=`${r}=${o};${s};path=/`}document.getElementById("submitButton").addEventListener("click",async()=>{if(d("hasSubmitted")){alert("You have already submitted data. Thank you for participating!");return}const r=parseInt(document.getElementById("age").value),o=parseInt(document.getElementById("height").value);if(isNaN(r)||isNaN(o)){alert("Please enter valid age and height.");return}try{const{error:e}=await l.from("submissions").insert([{age:r,height:o}]);e?(console.error("Error inserting data:",e.message),alert("Failed to submit data. Please try again.")):(w("hasSubmitted","true",30),alert("Data submitted successfully!"),await m(),document.getElementById("age").disabled=!0,document.getElementById("height").disabled=!0,document.getElementById("submitButton").disabled=!0)}catch(e){console.error("Unexpected error:",e),alert("An unexpected error occurred.")}});window.addEventListener("load",()=>{d("hasSubmitted")&&(document.getElementById("age").disabled=!0,document.getElementById("height").disabled=!0,document.getElementById("submitButton").disabled=!0,document.getElementById("submitButton").textContent="Already Submitted")});async function m(){try{const{data:r,error:o}=await l.from("submissions").select("*");if(o){console.error("Error fetching data:",o.message);return}const e={"<124":{count:0,ages:[]},"125-129":{count:0,ages:[]},"130-134":{count:0,ages:[]},"135-139":{count:0,ages:[]},"140-144":{count:0,ages:[]},"145-149":{count:0,ages:[]},"150-154":{count:0,ages:[]},"155-159":{count:0,ages:[]},"160-164":{count:0,ages:[]},"165-169":{count:0,ages:[]},"170-174":{count:0,ages:[]},"175-179":{count:0,ages:[]},">180":{count:0,ages:[]}};r.forEach(({height:t,age:n})=>{t<124?(e["<124"].count++,e["<124"].ages.push(n)):t<=129?(e["125-129"].count++,e["125-129"].ages.push(n)):t<=134?(e["130-134"].count++,e["130-134"].ages.push(n)):t<=139?(e["135-139"].count++,e["135-139"].ages.push(n)):t<=144?(e["140-144"].count++,e["140-144"].ages.push(n)):t<=149?(e["145-149"].count++,e["145-149"].ages.push(n)):t<=154?(e["150-154"].count++,e["150-154"].ages.push(n)):t<=159?(e["155-159"].count++,e["155-159"].ages.push(n)):t<=164?(e["160-164"].count++,e["160-164"].ages.push(n)):t<=169?(e["165-169"].count++,e["165-169"].ages.push(n)):t<=174?(e["170-174"].count++,e["170-174"].ages.push(n)):t<=179?(e["175-179"].count++,e["175-179"].ages.push(n)):(e[">180"].count++,e[">180"].ages.push(n))});const a=Object.keys(e),s=a.map(t=>e[t].count);u?(u.data.labels=a,u.data.datasets[0].data=s,u.update()):u=new Chart(B,{type:"bar",data:{labels:a,datasets:[{label:"Number of Individuals",data:s,backgroundColor:"rgba(233, 114, 76, 0.7)",borderColor:"#c5283d",borderWidth:2,borderRadius:4}]},options:{plugins:{tooltip:{callbacks:{title:t=>{const n=t[0].dataIndex,c=a[n],i=e[c].ages,g=i.length?Math.round(i.reduce((b,y)=>b+y)/i.length):0,f=Math.min(...i),p=Math.max(...i);return[`Height Range: ${c}`,`Age Range: ${f}-${p}`,`Average Age: ${g}`]},label:t=>`Count: ${Math.round(t.raw)}`}},legend:{labels:{font:{family:"'Segoe UI', system-ui, sans-serif"}}}},responsive:!0,scales:{y:{beginAtZero:!0,ticks:{stepSize:1,precision:0},title:{display:!0,text:"Number of Individuals",font:{family:"'Segoe UI', system-ui, sans-serif",weight:500}}},x:{title:{display:!0,text:"Height Ranges (cm)",font:{family:"'Segoe UI', system-ui, sans-serif",weight:500}}}}}})}catch(r){console.error("Unexpected error while updating chart:",r)}}m();
